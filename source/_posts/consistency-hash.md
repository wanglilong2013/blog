---
title: 一致性Hash算法到底是什么？
date: 2019-05-06 21:30:10
tags: [算法]
---
# 一致性Hash
-------

## 1.传统hash
举个栗子，我们有三台服务器s0、s1、s2分别用来存储我们的图片资源， 所有图片通过hash(文件名)%3来得到文件对应哪个服务器，这个时候如果要增加或减少一台服务器，
那么所有的资源就得重新映射一次。

## 1. 什么是一致性Hash?
如果你有接触过分布式系统，那么对一致性hash算法应该不会陌生，所谓一致性Hash算法就是一种特殊的Hash算法，目的是为了解决分布式缓存问题，在添加或者
移除服务器节点时，能尽可能小的改变请求资源和服务器的一个映射关系。

## 一致性hash算法是怎样做到尽可能小的改变呢？
服务器通过 hash(服务器编号) % 2的32次方计算出来的值对应到Hash环上的一个点， 图片资源也通过 hash(图片名) % 2的32次方计算对应环上的一个点，顺势方向对应的第一个服务器就是该图片所在位置。

## Hash环
一个由0到2的32次方减一的数字组成的一个圆环

## 一致性hash常见问题
如果服务器节点太少，则很有可能会出现Hash倾斜，也就是数据分布步均匀, 这个时候增加或删除节点可能会大幅改变文件和服务器之间的映射。

## 如何解决？
对于Hash倾斜问题，我们通常情况下可以引入`虚拟节点`来处理。

## 2. Docker 用途