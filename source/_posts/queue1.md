---
title: 消息队列常见问题
date: 2019-05-15 21:30:10
tags: [消息队列]
---


## 1. 如何确认消息被正常消费
一般情况下，消息被正常消费后，会向生产端发送一个消费完成指令。例如Nsq在消费完成后发送一个`FIN`指令

## 2.如何确保消息不被重复消费
上面讲到消费端在消费完成后会向生产端发送完成指令，但是有时候网络出问题，这个指令不一定会被生产者收到。这个时候生产端会认为这条消息未被正常消费，会将它冲入队列，经过一定时间排队，消费端会再次收到这个消息。
如何避免呢？我们通常的做法是在消费端坐一次`幂等`运算。

## 3. 消息积压如何处理
首先我们来分析一下，消息挤压是如何产生的呢？要么是生产端发送消息频率过快，要么是消费端消费速率太慢。基于这两个原因我们可以采取如下措施：
1. 优化消费端消费逻辑，提高消费速率。
2. 增加消费者数量，提高消费者数量。

## 4. 如何保证消息被顺序消费
不是所有的消息队列都支持消息的有序性，例如NSQ.如果想要做到消息被顺序消费，可以在业务放自定义一个协议，比如增加一个序列号来表示顺序。结合消费端的逻辑控制来实现顺序消费。





#